{"ast":null,"code":"import { remove } from \"./util.mjs\";\nconst defaultOptions = {\n  selector: \"img\"\n};\n\nclass LazyContainer {\n  constructor({\n    el,\n    binding,\n    vnode,\n    lazy\n  }) {\n    this.el = null;\n    this.vnode = vnode;\n    this.binding = binding;\n    this.options = {};\n    this.lazy = lazy;\n    this.queue = [];\n    this.update({\n      el,\n      binding\n    });\n  }\n\n  update({\n    el,\n    binding\n  }) {\n    this.el = el;\n    this.options = Object.assign({}, defaultOptions, binding.value);\n    const imgs = this.getImgs();\n    imgs.forEach(el2 => {\n      this.lazy.add(el2, Object.assign({}, this.binding, {\n        value: {\n          src: \"dataset\" in el2 ? el2.dataset.src : el2.getAttribute(\"data-src\"),\n          error: (\"dataset\" in el2 ? el2.dataset.error : el2.getAttribute(\"data-error\")) || this.options.error,\n          loading: (\"dataset\" in el2 ? el2.dataset.loading : el2.getAttribute(\"data-loading\")) || this.options.loading\n        }\n      }), this.vnode);\n    });\n  }\n\n  getImgs() {\n    return Array.from(this.el.querySelectorAll(this.options.selector));\n  }\n\n  clear() {\n    const imgs = this.getImgs();\n    imgs.forEach(el => this.lazy.remove(el));\n    this.vnode = null;\n    this.binding = null;\n    this.lazy = null;\n  }\n\n}\n\nclass LazyContainerManager {\n  constructor({\n    lazy\n  }) {\n    this.lazy = lazy;\n    this.queue = [];\n  }\n\n  bind(el, binding, vnode) {\n    const container = new LazyContainer({\n      el,\n      binding,\n      vnode,\n      lazy: this.lazy\n    });\n    this.queue.push(container);\n  }\n\n  update(el, binding, vnode) {\n    const container = this.queue.find(item => item.el === el);\n    if (!container) return;\n    container.update({\n      el,\n      binding,\n      vnode\n    });\n  }\n\n  unbind(el) {\n    const container = this.queue.find(item => item.el === el);\n    if (!container) return;\n    container.clear();\n    remove(this.queue, container);\n  }\n\n}\n\nexport { LazyContainerManager as default };","map":{"version":3,"names":["remove","defaultOptions","selector","LazyContainer","constructor","el","binding","vnode","lazy","options","queue","update","Object","assign","value","imgs","getImgs","forEach","el2","add","src","dataset","getAttribute","error","loading","Array","from","querySelectorAll","clear","LazyContainerManager","bind","container","push","find","item","unbind","default"],"sources":["D:/web/my-blog/node_modules/vant/es/lazyload/vue-lazyload/lazy-container.mjs"],"sourcesContent":["import { remove } from \"./util.mjs\";\nconst defaultOptions = {\n  selector: \"img\"\n};\nclass LazyContainer {\n  constructor({ el, binding, vnode, lazy }) {\n    this.el = null;\n    this.vnode = vnode;\n    this.binding = binding;\n    this.options = {};\n    this.lazy = lazy;\n    this.queue = [];\n    this.update({ el, binding });\n  }\n  update({ el, binding }) {\n    this.el = el;\n    this.options = Object.assign({}, defaultOptions, binding.value);\n    const imgs = this.getImgs();\n    imgs.forEach((el2) => {\n      this.lazy.add(el2, Object.assign({}, this.binding, {\n        value: {\n          src: \"dataset\" in el2 ? el2.dataset.src : el2.getAttribute(\"data-src\"),\n          error: (\"dataset\" in el2 ? el2.dataset.error : el2.getAttribute(\"data-error\")) || this.options.error,\n          loading: (\"dataset\" in el2 ? el2.dataset.loading : el2.getAttribute(\"data-loading\")) || this.options.loading\n        }\n      }), this.vnode);\n    });\n  }\n  getImgs() {\n    return Array.from(this.el.querySelectorAll(this.options.selector));\n  }\n  clear() {\n    const imgs = this.getImgs();\n    imgs.forEach((el) => this.lazy.remove(el));\n    this.vnode = null;\n    this.binding = null;\n    this.lazy = null;\n  }\n}\nclass LazyContainerManager {\n  constructor({ lazy }) {\n    this.lazy = lazy;\n    this.queue = [];\n  }\n  bind(el, binding, vnode) {\n    const container = new LazyContainer({\n      el,\n      binding,\n      vnode,\n      lazy: this.lazy\n    });\n    this.queue.push(container);\n  }\n  update(el, binding, vnode) {\n    const container = this.queue.find((item) => item.el === el);\n    if (!container)\n      return;\n    container.update({ el, binding, vnode });\n  }\n  unbind(el) {\n    const container = this.queue.find((item) => item.el === el);\n    if (!container)\n      return;\n    container.clear();\n    remove(this.queue, container);\n  }\n}\nexport {\n  LazyContainerManager as default\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}