{"ast":null,"code":"import { unref as _unref, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, isRef as _isRef, toDisplayString as _toDisplayString, vShow as _vShow, withDirectives as _withDirectives, normalizeStyle as _normalizeStyle, withCtx as _withCtx, vModelText as _vModelText, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, withModifiers as _withModifiers, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-34f73427\"), n = n(), _popScopeId(), n);\n\nconst _hoisted_1 = {\n  class: \"mapwps\"\n};\n\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"img\", {\n  class: \"mappoint\",\n  src: \"https://img1.baidu.com/it/u=1462787434,1779325197&fm=253&fmt=auto&app=138&f=JPEG?w=341&h=499\",\n  alt: \"\"\n}, null, -1));\n\nconst _hoisted_3 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  id: \"containers\",\n  class: \"map\",\n  tabindex: \"0\"\n}, null, -1));\n\nconst _hoisted_4 = {\n  class: \"topbar\"\n};\nconst _hoisted_5 = {\n  class: \"footbar\"\n};\n\nconst _hoisted_6 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", null, \"搜索地点\", -1));\n\nconst _hoisted_7 = {\n  class: \"b\"\n};\nconst _hoisted_8 = {\n  class: \"l\"\n};\nconst _hoisted_9 = {\n  class: \"l_t\"\n};\nconst _hoisted_10 = {\n  class: \"l_b\"\n};\nconst _hoisted_11 = {\n  class: \"r\"\n};\nconst _hoisted_12 = {\n  class: \"seachwps\"\n};\nconst _hoisted_13 = {\n  class: \"t\"\n};\nconst _hoisted_14 = {\n  class: \"l\"\n};\nconst _hoisted_15 = {\n  class: \"l_l\"\n};\nconst _hoisted_16 = {\n  class: \"l_r\"\n};\nconst _hoisted_17 = {\n  class: \"b\"\n};\nconst _hoisted_18 = {\n  key: 0,\n  style: {\n    \"overflow\": \"auto\",\n    \"height\": \"100%\"\n  }\n};\nconst _hoisted_19 = [\"onClick\"];\nconst _hoisted_20 = {\n  class: \"t_t\"\n};\nconst _hoisted_21 = {\n  class: \"b_b\"\n};\nconst _hoisted_22 = {\n  key: 1,\n  class: \"nolist\"\n};\nimport { throttle, debounce } from \"@/util/api.js\";\nimport axios from \"axios\";\nimport { mainStore } from \"@/pinia\";\nimport { onMounted, ref } from \"vue\";\nexport default {\n  name: 'chooseAddress',\n  props: {\n    //子组件接收父组件传递过来的值\n    jwd: Array\n  },\n  emits: ['cityinfo'],\n\n  setup(__props, {\n    expose,\n    emit: emits\n  }) {\n    const props = __props;\n    let store = mainStore(); //piain\n    //子组件给父组件传值–emit方式\n    //是否显示\n\n    let show = ref(false); // 地图实列对象\n\n    let map = ref(\"\"); //位置信息\n\n    let city = ref({\n      position: {\n        // 默认经纬度\n        lng: 121.5,\n        lat: 28.5\n      },\n      // 默认的逆解析信息，不写渲染会报错\n      regeocode: {\n        addressComponent: {}\n      }\n    }); // 搜索到的数据\n\n    let seachdata = ref([]); // 搜索地址是否显示\n\n    let seachcity = ref(false); // 搜索v-model\n\n    let seachtext = ref(\"\");\n\n    let int = function () {\n      AMapUI.loadUI([\"misc/PositionPicker\"], function (PositionPicker) {\n        console.log(PositionPicker);\n        map.value = new AMap.Map(\"containers\", {\n          zoom: 16,\n          center: [city.value.position.lng, city.value.position.lat],\n          //初始地图中心点\n          scrollWheel: false\n        });\n        var positionPicker = new PositionPicker({\n          mode: \"dragMap\",\n          map: map.value,\n          iconStyle: {\n            //自定义外观\n            url: \"//webapi.amap.com/ui/1.0/assets/position-picker2.png\",\n            ancher: [24, 40],\n            size: [0, 0] // 没办法，为了适配6sp\n\n          }\n        }); // 成功时 //positionResult里有多的推荐地址,且还有经纬度的逆解析信息\n\n        positionPicker.on(\"success\", function (positionResult) {\n          console.log(positionResult, '推荐地址'); // city.value = positionResult.regeocode.pois;\n\n          city.value = positionResult;\n        }); // 失败时\n\n        positionPicker.on(\"fail\", function (positionResult) {\n          city.value = \"\";\n        }); // 开始监听？\n\n        positionPicker.start();\n        map.value.panBy(0, 1);\n      });\n    };\n\n    let shows = function () {\n      int();\n      show.value = true; // 可以从本地获取自身经纬度\n    }; // 清除搜索的数据\n\n\n    let clear = function () {\n      seachtext.value = \"\";\n      seachdata.value = [];\n      seachcity.value = false;\n    }; // 选择搜索的其中一个地址\n\n\n    let choosecity = function (e) {\n      // console.log(789)\n      city.value.position.lat = seachdata.value[e].location.split(\",\")[1];\n      city.value.position.lng = seachdata.value[e].location.split(\",\")[0];\n      clear(); // 重新渲染下地(刷新图标位置)\n\n      int();\n    };\n\n    let shuru = debounce(function () {\n      if (!/^\\s+$/.test(seachtext.value) && seachtext.value != \"\") {\n        seach();\n      }\n    });\n\n    let seach = async function () {\n      // 搜索要找的地方，如果要返回距离当前中心点的距离 要仅在 周边搜索 模式的时候有值返回\n      let res = await axios.get(`https://restapi.amap.com/v3/place/text?key=e9c3882efb9588d0b87733a2b2b7ff38&keywords=${seachtext.value}`);\n\n      if (res.data.pois) {\n        seachdata.value = res.data.pois;\n      } else {\n        seachdata.value = [];\n      }\n    }; // 点击确认\n\n\n    let qr = function () {\n      show.value = false; // 返回位置信息给父组件,父组件接受方式不变\n\n      emits(\"cityinfo\", this.city);\n    }; // 点击取消\n\n\n    let qx = function () {\n      show.value = false;\n    };\n\n    onMounted(() => {\n      // console.log(props.jwd)\n      if (props.jwd) {\n        city.value.position.lat = props.jwd.lat;\n        city.value.position.lng = props.jwd.lng;\n      }\n    });\n    expose({\n      shows\n    });\n    return (_ctx, _cache) => {\n      const _component_van_icon = _resolveComponent(\"van-icon\");\n\n      const _component_van_popup = _resolveComponent(\"van-popup\");\n\n      const _component_van_overlay = _resolveComponent(\"van-overlay\");\n\n      return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_van_popup, {\n        show: _unref(show),\n        \"onUpdate:show\": _cache[3] || (_cache[3] = $event => _isRef(show) ? show.value = $event : show = $event),\n        position: \"bottom\"\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"div\", {\n          class: \"wps\",\n          style: _normalizeStyle({\n            height: _unref(store).phone.height + 'px'\n          })\n        }, [_hoisted_2, _hoisted_3, _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", {\n          class: \"l\",\n          onClick: _cache[0] || (_cache[0] = (...args) => _unref(qx) && _unref(qx)(...args))\n        }, \"取消\"), _createElementVNode(\"div\", {\n          class: \"r\",\n          onClick: _cache[1] || (_cache[1] = (...args) => _unref(qr) && _unref(qr)(...args))\n        }, \"确认\")]), _withDirectives(_createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"div\", {\n          class: \"t\",\n          onClick: _cache[2] || (_cache[2] = $event => _isRef(seachcity) ? seachcity.value = true : seachcity = true)\n        }, [_createVNode(_component_van_icon, {\n          name: \"search\"\n        }), _hoisted_6]), _createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"div\", _hoisted_9, _toDisplayString(_unref(city).address), 1), _createElementVNode(\"div\", _hoisted_10, _toDisplayString(_unref(city).regeocode.addressComponent.township + _unref(city).regeocode.addressComponent.street + _unref(city).regeocode.addressComponent.streetNumber), 1)]), _createElementVNode(\"div\", _hoisted_11, [_createVNode(_component_van_icon, {\n          color: \"#1cd66c\",\n          name: \"success\"\n        })])])], 512), [[_vShow, _unref(show)]])], 4)]),\n        _: 1\n      }, 8, [\"show\"]), _createVNode(_component_van_overlay, {\n        show: _unref(seachcity),\n        onClick: _cache[7] || (_cache[7] = _withModifiers($event => _unref(clear)(), [\"self\"])),\n        \"lock-scroll\": false\n      }, {\n        default: _withCtx(() => [_createElementVNode(\"div\", _hoisted_12, [_createElementVNode(\"div\", _hoisted_13, [_createElementVNode(\"div\", _hoisted_14, [_createElementVNode(\"div\", _hoisted_15, [_createVNode(_component_van_icon, {\n          name: \"search\"\n        })]), _createElementVNode(\"div\", _hoisted_16, [_withDirectives(_createElementVNode(\"input\", {\n          \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => _isRef(seachtext) ? seachtext.value = $event : seachtext = $event),\n          placeholder: \"地址关键字\",\n          onInput: _cache[5] || (_cache[5] = (...args) => _unref(shuru) && _unref(shuru)(...args)),\n          type: \"text\"\n        }, null, 544), [[_vModelText, _unref(seachtext)]])])]), _createElementVNode(\"div\", {\n          class: \"r\",\n          onClick: _cache[6] || (_cache[6] = $event => _unref(clear)())\n        }, \"取消\")]), _createElementVNode(\"div\", _hoisted_17, [_unref(seachdata).length > 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_18, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(seachdata), (item, index) => {\n          return _openBlock(), _createElementBlock(\"div\", {\n            class: \"bwp\",\n            key: index,\n            onClick: $event => _unref(choosecity)(index)\n          }, [_createElementVNode(\"div\", null, [_createElementVNode(\"div\", _hoisted_20, _toDisplayString(item.name), 1), _createElementVNode(\"div\", _hoisted_21, _toDisplayString(item.address), 1)])], 8, _hoisted_19);\n        }), 128))])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_22, _toDisplayString(_unref(seachtext) == \"\" ? \"请输入地址关键词\" : \"暂未数据,换个关键词试试吧\"), 1))])])]),\n        _: 1\n      }, 8, [\"show\"])]);\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["throttle","debounce","axios","mainStore","onMounted","ref","store","show","map","city","position","lng","lat","regeocode","addressComponent","seachdata","seachcity","seachtext","int","AMapUI","loadUI","PositionPicker","console","log","value","AMap","Map","zoom","center","scrollWheel","positionPicker","mode","iconStyle","url","ancher","size","on","positionResult","start","panBy","shows","clear","choosecity","e","location","split","shuru","test","seach","res","get","data","pois","qr","emits","qx","props","jwd","expose"],"sources":["D:/web/my-blog/src/components/map/components/chooseAddress.vue"],"sourcesContent":["<!-- 高德选择地址组件，可以类似微信那样搞出多个选择结果 支持搜索，但不显示距离\r\n（该组件在map.vue里）\r\n-->\r\n<template>\r\n  <div class=\"mapwps\">\r\n    <van-popup v-model:show=\"show\" position=\"bottom\">\r\n      <div class=\"wps\" :style=\"{height:store.phone.height+'px'} \">\r\n        <img\r\n            class=\"mappoint\"\r\n            src=\"https://img1.baidu.com/it/u=1462787434,1779325197&fm=253&fmt=auto&app=138&f=JPEG?w=341&h=499\"\r\n            alt=\"\"\r\n        />\r\n        <div id=\"containers\" class=\"map\" tabindex=\"0\"></div>\r\n        <div class=\"topbar\">\r\n          <div class=\"l\" @click=\"qx\">取消</div>\r\n\r\n          <div class=\"r\" @click=\"qr\">确认</div>\r\n        </div>\r\n        <div class=\"footbar\" v-show=\"show\">\r\n          <div class=\"t\" @click=\"seachcity = true\">\r\n            <van-icon name=\"search\"/>\r\n            <div>搜索地点</div>\r\n          </div>\r\n\r\n          <div class=\"b\">\r\n              <div class=\"l\" >\r\n                <div class=\"l_t\">\r\n                  {{ city.address }}\r\n                </div>\r\n                <div class=\"l_b\">\r\n                  {{\r\n                    city.regeocode.addressComponent.township +\r\n                    city.regeocode.addressComponent.street +\r\n                    city.regeocode.addressComponent.streetNumber\r\n                  }}\r\n                </div>\r\n              </div>\r\n              <div class=\"r\">\r\n                <van-icon color=\"#1cd66c\" name=\"success\"/>\r\n              </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </van-popup>\r\n    <!-- 搜索 -->\r\n    <!-- lock-scroll为遮罩层里的类容是否可以滚动，默认是不能，改成false就可以滚动了 -->\r\n    <van-overlay :show=\"seachcity\" @click.self=\"clear()\" :lock-scroll=\"false\">\r\n      <div class=\"seachwps\">\r\n        <div class=\"t\">\r\n          <div class=\"l\">\r\n            <div class=\"l_l\">\r\n              <van-icon name=\"search\"/>\r\n            </div>\r\n            <div class=\"l_r\">\r\n              <input\r\n                  v-model=\"seachtext\"\r\n                  placeholder=\"地址关键字\"\r\n                  @input=\"shuru\"\r\n                  type=\"text\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <div class=\"r\" @click=\"clear()\">取消</div>\r\n        </div>\r\n        <div class=\"b\">\r\n          <div v-if=\"seachdata.length > 0\" style=\"overflow: auto; height: 100%\">\r\n            <div\r\n                class=\"bwp\"\r\n                v-for=\"(item, index) in seachdata\"\r\n                :key=\"index\"\r\n                @click=\"choosecity(index)\"\r\n            >\r\n              <div>\r\n                <div class=\"t_t\">{{ item.name }}</div>\r\n                <div class=\"b_b\">{{ item.address }}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div v-else class=\"nolist\">\r\n            {{\r\n              seachtext == \"\" ? \"请输入地址关键词\" : \"暂未数据,换个关键词试试吧\"\r\n            }}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </van-overlay>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {throttle, debounce} from \"@/util/api.js\";\r\nimport axios from \"axios\";\r\n\r\nimport {mainStore} from \"@/pinia\";\r\n\r\nimport {onMounted, ref,} from \"vue\";\r\n\r\nconst props = defineProps({\r\n  //子组件接收父组件传递过来的值\r\n  jwd: Array\r\n})\r\nlet store = mainStore() //piain\r\n\r\n//子组件给父组件传值–emit方式\r\nlet emits = defineEmits(['cityinfo'])\r\n//是否显示\r\nlet show = ref(false)\r\n// 地图实列对象\r\nlet map = ref(\"\");\r\n//位置信息\r\nlet city = ref({\r\n  position: {\r\n    // 默认经纬度\r\n    lng: 121.5,\r\n    lat: 28.5,\r\n  },\r\n  // 默认的逆解析信息，不写渲染会报错\r\n  regeocode: {\r\n    addressComponent: {},\r\n  },\r\n});\r\n// 搜索到的数据\r\nlet seachdata = ref([]);\r\n// 搜索地址是否显示\r\nlet seachcity = ref(false);\r\n// 搜索v-model\r\nlet seachtext = ref(\"\");\r\n\r\nlet int = function () {\r\n  AMapUI.loadUI([\"misc/PositionPicker\"], function (PositionPicker) {\r\n    console.log(PositionPicker);\r\n    map.value = new AMap.Map(\"containers\", {\r\n      zoom: 16,\r\n      center: [city.value.position.lng, city.value.position.lat], //初始地图中心点\r\n      scrollWheel: false,\r\n    });\r\n\r\n    var positionPicker = new PositionPicker({\r\n      mode: \"dragMap\",\r\n      map: map.value,\r\n      iconStyle: {\r\n        //自定义外观\r\n        url: \"//webapi.amap.com/ui/1.0/assets/position-picker2.png\",\r\n        ancher: [24, 40],\r\n        size: [0, 0], // 没办法，为了适配6sp\r\n      },\r\n    });\r\n\r\n    // 成功时 //positionResult里有多的推荐地址,且还有经纬度的逆解析信息\r\n    positionPicker.on(\"success\", function (positionResult) {\r\n      console.log(positionResult,'推荐地址')\r\n      // city.value = positionResult.regeocode.pois;\r\n      city.value = positionResult ;\r\n    });\r\n\r\n    // 失败时\r\n    positionPicker.on(\"fail\", function (positionResult) {\r\n      city.value = \"\";\r\n    });\r\n\r\n    // 开始监听？\r\n    positionPicker.start();\r\n    map.value.panBy(0, 1);\r\n  });\r\n};\r\nlet shows = function () {\r\n  int()\r\n  show.value = true;\r\n  // 可以从本地获取自身经纬度\r\n};\r\n\r\n// 清除搜索的数据\r\nlet clear = function () {\r\n  seachtext.value = \"\";\r\n  seachdata.value = [];\r\n  seachcity.value = false;\r\n};\r\n\r\n// 选择搜索的其中一个地址\r\nlet choosecity = function (e) {\r\n  // console.log(789)\r\n  city.value.position.lat = seachdata.value[e].location.split(\",\")[1];\r\n  city.value.position.lng = seachdata.value[e].location.split(\",\")[0];\r\n  clear();\r\n\r\n  // 重新渲染下地(刷新图标位置)\r\n  int();\r\n};\r\n\r\nlet shuru = debounce(function () {\r\n  if (!/^\\s+$/.test(seachtext.value) && seachtext.value != \"\") {\r\n    seach()\r\n  }\r\n});\r\n\r\nlet seach = async function () {\r\n  // 搜索要找的地方，如果要返回距离当前中心点的距离 要仅在 周边搜索 模式的时候有值返回\r\n  let res = await axios.get(`https://restapi.amap.com/v3/place/text?key=e9c3882efb9588d0b87733a2b2b7ff38&keywords=${seachtext.value}`)\r\n  if (res.data.pois) {\r\n    seachdata.value = res.data.pois;\r\n  } else {\r\n    seachdata.value = [];\r\n  }\r\n};\r\n\r\n// 点击确认\r\nlet qr = function () {\r\n  show.value = false;\r\n\r\n  // 返回位置信息给父组件,父组件接受方式不变\r\n  emits(\"cityinfo\", this.city);\r\n};\r\n\r\n// 点击取消\r\nlet qx = function () {\r\n  show.value = false;\r\n};\r\nonMounted(() => {\r\n  // console.log(props.jwd)\r\n  if (props.jwd) {\r\n    city.value.position.lat = props.jwd.lat;\r\n    city.value.position.lng = props.jwd.lng;\r\n  }\r\n})\r\ndefineExpose({shows})\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n:deep(.van-icon-success) {\r\n  font-size: 50px;\r\n}\r\n\r\n.mapwps {\r\n  z-index: 9999;\r\n\r\n  .wps {\r\n    position: relative;\r\n    width: 100vw;\r\n\r\n    .topbar {\r\n      background: rgba(0, 0, 0, 0.2);\r\n      width: calc(100% - 30px);\r\n      display: flex;\r\n      align-content: center;\r\n      justify-content: space-between;\r\n      position: absolute;\r\n      z-index: 9999;\r\n      top: 0;\r\n      left: 0;\r\n      padding: 15px;\r\n      font-size: 16px;\r\n      //   font-weight: bold;\r\n      .l {\r\n        color: white;\r\n        background: red;\r\n        padding: 10px 16px;\r\n        box-sizing: border-box;\r\n        border-radius: 10px;\r\n      }\r\n\r\n      .r {\r\n        background: #2cdb71;\r\n        padding: 10px 16px;\r\n        box-sizing: border-box;\r\n        border-radius: 10px;\r\n        color: white;\r\n      }\r\n    }\r\n\r\n    .footbar {\r\n      box-shadow: 0px 2px 5px 0px #0000001a;\r\n      position: absolute;\r\n      padding: 30px;\r\n      bottom: env(safe-area-inset-bottom);\r\n      left: 0;\r\n      z-index: 999;\r\n      width: calc(100% - 60px);\r\n      background: white;\r\n      font-size: 37px;\r\n      // display: flex;\r\n      // align-items: center;\r\n      .t {\r\n        display: flex;\r\n        align-items: center;\r\n        width: 100%;\r\n        background: #eeeeee;\r\n        padding: 15px 0;\r\n        // margin-top: 15px;\r\n        margin-bottom: 50px;\r\n        border-radius: 5px;\r\n        justify-content: center;\r\n\r\n        .van-icon-search {\r\n          font-size: 16px;\r\n        }\r\n\r\n        div {\r\n          margin-left: 5px;\r\n          font-size: 16px;\r\n          color: #747474;\r\n        }\r\n      }\r\n\r\n      .b {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        font-size: 16px;\r\n\r\n        .l {\r\n          flex: auto;\r\n\r\n          .l_t {\r\n          }\r\n\r\n          .l_b {\r\n            color: #747474;\r\n            margin-top: 10px;\r\n          }\r\n        }\r\n\r\n        .r {\r\n          flex-shrink: 0;\r\n          margin-left: 15px;\r\n        }\r\n      }\r\n    }\r\n\r\n    .mappoint {\r\n      position: absolute;\r\n      width: 21px;\r\n      height: 30px;\r\n      z-index: 999999;\r\n      left: 50%;\r\n      top: calc(50% - 25px);\r\n      transform: translate(-50%, -50%);\r\n    }\r\n  }\r\n\r\n  .map {\r\n    width: 100%;\r\n    height: 100%;\r\n    z-index: 99;\r\n  }\r\n\r\n  #right {\r\n    top: 0;\r\n    position: fixed;\r\n  }\r\n\r\n  .seachwps {\r\n    position: fixed;\r\n    bottom: 0;\r\n    width: 80vw;\r\n    border-radius: 10px;\r\n    background: white;\r\n    left: 50%;\r\n    // top: 50%;\r\n    bottom: 50%;\r\n    transform: translate(-50%, 50%);\r\n    z-index: 8959;\r\n    padding: 15px;\r\n    // overflow: hidden;\r\n    .t {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      font-size: 16px;\r\n\r\n      .l {\r\n        padding: 5px 0;\r\n        border-radius: 10px;\r\n        flex: auto;\r\n        background: #eeeeee;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n\r\n        .l_l {\r\n          flex-shrink: 0;\r\n          margin: 0 15px;\r\n          display: flex;\r\n          align-items: center;\r\n          justify-content: center;\r\n\r\n          .van-icon-search {\r\n            font-size: 16px;\r\n          }\r\n        }\r\n\r\n        .l_r {\r\n          flex: auto;\r\n\r\n          input {\r\n            width: 100%;\r\n            border: none;\r\n            box-sizing: border-box;\r\n            background: none;\r\n          }\r\n        }\r\n      }\r\n\r\n      .r {\r\n        margin-left: 15px;\r\n        flex-shrink: 0;\r\n        color: #4b5466;\r\n      }\r\n    }\r\n\r\n    .b {\r\n      // background: ;\r\n      margin-top: 30px;\r\n      height: 40vh;\r\n      overflow: auto;\r\n      // -webkit-overflow-scrolling: touch;\r\n      .bwp {\r\n        padding: 20px 0;\r\n        display: flex;\r\n        flex-direction: column;\r\n        border-bottom: 1px solid #f7f7f7;\r\n        overflow: hidden;\r\n\r\n        .t_t {\r\n          overflow: hidden;\r\n          white-space: nowrap;\r\n          text-overflow: ellipsis;\r\n          font-size: 16px;\r\n        }\r\n\r\n        .b_b {\r\n          margin-top: 5px;\r\n          text-overflow: ellipsis;\r\n          white-space: nowrap;\r\n          overflow: hidden;\r\n          font-size: 16px;\r\n          color: #8b8b8b;\r\n        }\r\n      }\r\n\r\n      .nolist {\r\n        width: 100%;\r\n        height: 100%;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-size: 16px;\r\n      }\r\n    }\r\n  }\r\n\r\n  // 遮罩层层级\r\n  .van-overlay {\r\n    z-index: 9999;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}